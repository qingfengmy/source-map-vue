{"version":3,"file":"User-CDEMc_fs.js","sources":["../../src/views/preview.vue","../../src/views/User.vue"],"sourcesContent":["<template>\n    <div class=\"pre-code\">\n        <div class=\"error-detail\">\n          <pre class=\"error-code\" v-html=\"preLine()\"></pre>\n        </div>\n    </div>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: \"preview\",\n  props:{\n    origin: Object,\n  },\n  methods: {\n    preLine(){\n      console.log(this.origin,'origin')\n      const line = this.origin.line;\n      const originCodeLine = this.origin.source.split('\\n');\n      const len = originCodeLine.length - 1;\n      const start = line - 3 > 0 ? line - 3 : 0;\n      const end = line + 5 < len ? line + 3 : len; // 最多展示6行\n      let newLines = [];\n      for (let i = start; i <= end; i++) {\n        const content = i+1 +'.   ' + this.encodeHTML(originCodeLine[i])\n        newLines.push(`<div class='code-line ${i+1==line? 'heightlight' : ''}'>${content}</div>`) \n      }\n      return newLines.join('');\n    },\n    encodeHTML(str:string){\n      return str.replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#39;');\n    }\n  }\n}\n</script>","<template>\n <el-form :model=\"form\" label-position=\"top\">\n      <el-form-item label=\"Promotion name\" :label-width=\"formLabelWidth\">\n        <el-input\n          v-model=\"form.stackFrame\"\n          autocomplete=\"off\"\n          :rows=\"5\"\n          type=\"textarea\"\n        />\n      </el-form-item>\n      <el-form-item label=\"Zones\" :label-width=\"formLabelWidth\">\n        <el-upload drag :before-upload=\"beforeUpload\">\n          <el-button type=\"primary\">Click to upload</el-button>\n        </el-upload>\n      </el-form-item>\n    </el-form>\n    <preview :origin=\"origin\" />\n</template>\n\n<script setup lang=\"ts\">\nimport { reactive, ref, watch } from \"vue\";\nimport sourceMap from 'source-map-js'\nimport preview from './preview.vue'\n\nconst formLabelWidth = \"140px\";\n\nconst form = reactive({\n  stackFrame: \"\",\n  sourceMap: \"\",\n});\n\nconst origin = ref({\n  source: \"\",\n  line: 0,\n  column: 0,\n});\n\nwatch(origin, (newVal) => {\n  console.log(newVal,'newVal')\n})\n\nconst beforeUpload = async (file: File) => {\n  console.log(file);\n  const reader = new FileReader();\n  reader.readAsText(file, \"utf-8\");\n  reader.onload = async (e) => {\n    console.log(e);\n    const sourceMap = JSON.parse(e.target?.result as string);\n    console.log('sourceMap', sourceMap)\n    const stackFrame = JSON.parse(form.stackFrame);\n    const source =  await getSource(sourceMap, stackFrame.lineNumber, stackFrame.columnNumber);\n    console.log('source', source);\n    origin.value = source as any;\n  };\n  return false;\n};\n\nconst getSource = async (code: any, line: any, column: any) => {\n  const consumer = await new sourceMap.SourceMapConsumer(code);\n  console.log('code', code)\n  console.log('line', line)\n  console.log('column', column)\n  const originalPosition = consumer.originalPositionFor({ line, column });\n  console.log('originalPosition', originalPosition)\n  const source = consumer.sourceContentFor(originalPosition.source);\n  return {\n    source,\n    column: originalPosition.column,\n    line: originalPosition.line,\n  }\n};\n</script>\n<style>\n.error-code{\n  padding: 20px;\n  font-family: consolas, monospace;\n  word-wrap: normal;\n}\n.code-line{\n  padding:4px\n}\n.code-line.heightlight{\n  color: #fff;\n  background-color: #f22222;\n}\n</style>"],"names":["_sfc_main$1","line","originCodeLine","len","start","end","newLines","i","content","str","_hoisted_1","_hoisted_2","_openBlock","_createElementBlock","_createElementVNode","$options","_hoisted_3","formLabelWidth","form","reactive","origin","ref","watch","newVal","beforeUpload","file","reader","e","sourceMap","stackFrame","source","getSource","code","column","consumer","originalPosition","_createVNode","_component_el_form","_component_el_form_item","_component_el_input","_cache","$event","_component_el_upload","_component_el_button","preview"],"mappings":"mIASA,MAAAA,EAAe,CACb,KAAM,UACN,MAAM,CACJ,OAAQ,MAAA,EAEV,QAAS,CACP,SAAS,CACP,QAAQ,IAAI,KAAK,OAAO,QAAQ,EAChC,MAAMC,EAAO,KAAK,OAAO,KACnBC,EAAiB,KAAK,OAAO,OAAO,MAAM;AAAA,CAAI,EAC9CC,EAAMD,EAAe,OAAS,EAC9BE,EAAQH,EAAO,EAAI,EAAIA,EAAO,EAAI,EAClCI,EAAMJ,EAAO,EAAIE,EAAMF,EAAO,EAAIE,EACxC,IAAIG,EAAW,CAAA,EACf,QAASC,EAAIH,EAAOG,GAAKF,EAAKE,IAAK,CACjC,MAAMC,EAAUD,EAAE,EAAG,OAAS,KAAK,WAAWL,EAAeK,CAAC,CAAC,EAC/DD,EAAS,KAAK,yBAAyBC,EAAE,GAAGN,EAAM,cAAgB,EAAE,KAAKO,CAAO,QAAQ,CAC1F,CACA,OAAOF,EAAS,KAAK,EAAE,CACzB,EACA,WAAWG,EAAW,CACpB,OAAOA,EAAI,QAAQ,KAAM,OAAO,EAC7B,QAAQ,KAAM,MAAM,EACpB,QAAQ,KAAM,MAAM,EACpB,QAAQ,KAAM,QAAQ,EACtB,QAAQ,KAAM,OAAO,CAC1B,CAAA,CAEJ,EApCSC,EAAA,CAAA,MAAM,UAAA,EACFC,EAAA,CAAA,MAAM,cAAA,0CADf,OAAAC,EAAA,EAAAC,EAIM,MAJNH,EAIM,CAHFI,EAEM,MAFNH,EAEM,CADJG,EAAiD,MAAA,CAA5C,MAAM,aAAa,UAAQC,EAAA,QAAA,CAAO,EAAA,KAAA,EAAAC,CAAA,kCCqB3CC,EAAiB,oCAEvB,MAAMC,EAAOC,EAAS,CACpB,WAAY,GACZ,UAAW,EAAA,CACZ,EAEKC,EAASC,EAAI,CACjB,OAAQ,GACR,KAAM,EACN,OAAQ,CAAA,CACT,EAEDC,EAAMF,EAASG,GAAW,CACxB,QAAQ,IAAIA,EAAO,QAAQ,CAC7B,CAAC,EAED,MAAMC,EAAe,MAAOC,GAAe,CACzC,QAAQ,IAAIA,CAAI,EAChB,MAAMC,EAAS,IAAI,WACnB,OAAAA,EAAO,WAAWD,EAAM,OAAO,EAC/BC,EAAO,OAAS,MAAOC,GAAM,CAC3B,QAAQ,IAAIA,CAAC,EACb,MAAMC,EAAY,KAAK,MAAMD,EAAE,QAAQ,MAAgB,EACvD,QAAQ,IAAI,YAAaC,CAAS,EAClC,MAAMC,EAAa,KAAK,MAAMX,EAAK,UAAU,EACvCY,EAAU,MAAMC,EAAUH,EAAWC,EAAW,WAAYA,EAAW,YAAY,EACzF,QAAQ,IAAI,SAAUC,CAAM,EAC5BV,EAAO,MAAQU,CACjB,EACO,EACT,EAEMC,EAAY,MAAOC,EAAW/B,EAAWgC,IAAgB,CAC7D,MAAMC,EAAW,MAAM,IAAIN,EAAU,kBAAkBI,CAAI,EAC3D,QAAQ,IAAI,OAAQA,CAAI,EACxB,QAAQ,IAAI,OAAQ/B,CAAI,EACxB,QAAQ,IAAI,SAAUgC,CAAM,EAC5B,MAAME,EAAmBD,EAAS,oBAAoB,CAAE,KAAAjC,EAAM,OAAAgC,EAAQ,EACtE,eAAQ,IAAI,mBAAoBE,CAAgB,EAEzC,CACL,OAFaD,EAAS,iBAAiBC,EAAiB,MAAM,EAG9D,OAAQA,EAAiB,OACzB,KAAMA,EAAiB,IAAA,CAE3B,gIArECC,EAcaC,EAAA,CAdH,MAAOnB,EAAM,iBAAe,KAAA,aACjC,IAOe,CAPfkB,EAOeE,EAAA,CAPD,MAAM,iBAAkB,cAAarB,CAAA,aACjD,IAKE,CALFmB,EAKEG,EAAA,CAJS,WAAArB,EAAK,WAAL,sBAAAsB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAvB,EAAK,WAAUuB,GACxB,aAAa,MACZ,KAAM,EACP,KAAK,UAAA,iCAGTL,EAIeE,EAAA,CAJD,MAAM,QAAS,cAAarB,CAAA,aACxC,IAEY,CAFZmB,EAEYM,EAAA,CAFD,KAAA,GAAM,gBAAelB,CAAA,aAC9B,IAAqD,CAArDY,EAAqDO,EAAA,CAA1C,KAAK,WAAS,WAAC,IAAe,CAAA,GAAAH,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAAf,kBAAe,EAAA,CAAA,+CAI/CJ,EAA4BQ,EAAA,CAAlB,OAAQxB,EAAA,KAAA,EAAM,KAAA,EAAA,CAAA,QAAA,CAAA,CAAA"}